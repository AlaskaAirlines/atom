<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Atom  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Atom  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Atom Docs</a> (99% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Atom Reference</a>
        <img id="carat" src="img/carat.png" />
        Atom  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AtomError.html">AtomError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RequestableError.html">RequestableError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Optional.html">Optional</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLResponse.html">URLResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/BasicCredentialConvertible.html">BasicCredentialConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ClientCredentialConvertible.html">ClientCredentialConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:4Atom5ModelP">Model</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Requestable.html">Requestable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TokenCredentialWritable.html">TokenCredentialWritable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/Atom.html">Atom</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/AuthenticationMethod.html">– AuthenticationMethod</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/AuthorizationEndpoint.html">– AuthorizationEndpoint</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/BaseURL.html">– BaseURL</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/BasicCredential.html">– BasicCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/ClientCredential.html">– ClientCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/HeaderItem.html">– HeaderItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/Method.html">– Method</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/Response.html">– Response</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/TokenCredential.html">– TokenCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/URLPath.html">– URLPath</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/Service.html">– Service</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Atom/ServiceConfiguration.html">– ServiceConfiguration</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h2 id='overview' class='heading'>Overview</h2>

<p>The lightweight &amp; delightful networking library.</p>

<p>Atom is a wrapper library built around a subset of features offered by <code>URLSession</code> with added ability to decode data into models, handle access token refresh and authorization headers on behalf of the client, and more. It takes advantage of Swift features such as default implementation for protocols, generics and <code>Decodable</code> to make it extremely easy to integrate and use in an existing project. Atom offers support for any endpoint, a much stricter URL host and path validation, comprehensive documentation and an example application to eliminate any guesswork.</p>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>[x] Simple to setup, easy to use &amp; efficient</li>
<li>[x] Supports any endpoint</li>
<li>[x] Handles object decoding from data returned by the service</li>
<li>[x] Handles token refresh</li>
<li>[x] Handles and applies authorization headers on behalf of the client</li>
<li>[x] Handles URL host validation</li>
<li>[x] Handles URL path validation</li>
<li>[x] Complete Documentation</li>
</ul>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 11.0+</li>
<li>Xcode 11.0+</li>
<li>Swift 5.0+</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='carthage' class='heading'>Carthage</h3>

<p><a href="https://github.com/Carthage/Carthage">Carthage</a> is a decentralized dependency manager that builds your dependencies and provides you with binary frameworks. To integrate Atom into your Xcode project using Carthage, specify it in your <code>Cartfile</code>:</p>
<pre class="highlight plaintext"><code>git "https://github.com/AlaskaAirlines/atom" ~&gt; 1.0.0
</code></pre>

<p>For more information on getting started with Carthage, visit the <a href="https://github.com/Carthage/Carthage">repo</a>.</p>
<h3 id='swift-package-manager' class='heading'>Swift Package Manager</h3>

<p>The <a href="https://swift.org/package-manager/">Swift Package Manager</a> is a tool for automating the distribution of Swift code and is integrated into the <code>swift</code> compiler.</p>

<p>Once you have your Swift package set up, adding Atom as a dependency is as easy as adding it to the <code>dependencies</code> value of your <code>Package.swift</code>.</p>
<h2 id='usage' class='heading'>Usage</h2>

<p>Getting started is easy. First, create an instance of Atom.</p>
<pre class="highlight plaintext"><code>let atom = Atom()
</code></pre>

<p>In the above example, default configuration will be used. Default configuration will setup <code>URLSession</code>to use ephemeral configuration as well as ensure that the data returned by the service is available on the main thread.</p>

<p>Any network request needs to conform and implement <code><a href="Protocols/Requestable.html">Requestable</a></code> protocol. The <code><a href="Protocols/Requestable.html">Requestable</a></code> protocol provides default implementation for all of its properties - except for the <code>func baseURL() throws -&gt; Atom.BaseURL</code>. See documentation for more information.</p>
<pre class="highlight plaintext"><code>extension Seatmap {
    enum Endpoint: Requestable {
        case refresh

        func baseURL() throws -&gt; Atom.BaseURL {
            try Atom.BaseURL(host: "api.alaskaair.net")
        }
    }
}
</code></pre>

<p>Atom offers a handful of methods with support for fully decoded model objects, raw data,  or status indicating success / failure of a request.</p>
<pre class="highlight plaintext"><code>typealias Endpoint = Seatmap.Endpoint

service.load(Endpoint.refresh).execute(expecting: Seatmap.self) { [weak self] result in
    switch result {
        case .failure(let error):
        // Handle error.

        case .success(let seatmap):
        // Handle seatmap model.
    }
}
</code></pre>

<p>The above example demonstrates how to use <code>execute()</code> method to get a fully decoded <code>Seatmap</code> model object.</p>

<p>For more information, please see documentation.</p>
<h3 id='authentication' class='heading'>Authentication</h3>

<p>Atom can be configured to apply authorization headers on behalf of the client. </p>

<p>Atom supports <code>Basic</code> and <code>Bearer</code> authentication methods. When configured properly, Atom will perform automatic token refresh on behalf of the client if it determines that the access token being used has expired. Any in-flight calls will be enqueued and executed once a new token is obtained. </p>

<p>If the token refresh call fails, all enqueued network calls will be executed at once with completions set to <code><a href="Enums/AtomError.html">AtomError</a></code> failure.</p>
<h3 id='basic' class='heading'>Basic</h3>

<p>You can configure Atom to apply <code>Basic</code> authorization header like this:</p>
<pre class="highlight plaintext"><code>let atom: Atom = {
    let credential = Atom.BasicCredential(password: "password", username: "username")
    let basic = Atom.AuthenticationMethod.basic(credential)
    let configuration = Atom.ServiceConfiguration(authenticationMethod: basic)

    return Atom(serviceConfiguration: configuration)
}()

</code></pre>

<p>An existing implementation can be extended by conforming and implementing <code><a href="Protocols/BasicCredentialConvertible.html">BasicCredentialConvertible</a></code> protocol. A hypothetical configuration can look something like this:</p>
<pre class="highlight plaintext"><code>final class CredentialManager {
    private(set) var username = String()
    private(set) var password = String()

    static let shared = CredentialManager()
    private init() { }

    func update(username aUsername: String) {
        username = aUsername
    }

    func update(password aPassword: String) {
        password = aPassword
    }
}

extension CredentialManager: BasicCredentialConvertible {
    var basicCredential: Atom.BasicCredential {
        .init(password: password, username: username)
    }
}

let atom: Atom = {
    let basic = Atom.AuthenticationMethod.basic(CredentialManager.shared.basicCredential)
    let configuration = Atom.ServiceConfiguration(authenticationMethod: basic)

    return Atom(serviceConfiguration: configuration)
}()

</code></pre>

<p>Once configured, Atom will combine username and password into a single string <code>username:password</code>, encode the result using base 64 encoding algorithm and apply it to a request as a <code>Authorization: Basic TGlmZSBoYXMgYSBtZWFuaW5nLg==</code> header key-value.</p>
<h3 id='bearer' class='heading'>Bearer</h3>

<p>You can configure Atom to apply <code>Bearer</code> authorization header. Here is an example:</p>
<pre class="highlight plaintext"><code>class TokenManager: TokenCredentialWritable {
    var tokenCredential: Atom.TokenCredential {
        // Read values from the keychain.
        get { keychain.tokenCredential() }

        // Save new value to the keychain.  
        set { keychain.save(tokenCredential: newValue)  }
    }
}

let atom: Atom = {
    let endpoint = Atom.AuthorizationEndpoint(host: "api.alaskaair.net", path: "/oauth2")
    let clientCredential = Atom.ClientCredential(id: "client-id", secret: "client-secret")
    let tokenManager = TokenManager()

    let bearer = Atom.AuthenticationMethod.bearer(endpoint, clientCredential, tokenManager)
    let configuration = Atom.ServiceConfiguration(authenticationMethod: bearer)

    return Atom(serviceConfiguration: configuration)
}()
</code></pre>

<p>The setup is hopefully easy to understand. Atom requires a few pieces of information from the client:</p>

<ol>
<li>Authorization endpoint - Atom needs to know where to call to get a new token.</li>
<li>Client credentials - Atom needs access to client id and client secret to get a new token.</li>
<li>Token credential writable - Atom will pass newly obtained credentials to a client for safe storage.</li>
</ol>

<p>Once configured, Atom will apply authorization header to a request as <code>Authorization: Bearer ...</code> header key-value.</p>

<p>Please note, Atom will only decode token credential from a JSON objecting returned in this form:</p>
<pre class="highlight plaintext"><code>{
    "access_token": "2YotnFZFEjr1zCsicMWpAA",
    "expires_in": 3600,
    "refresh_token": "tGzv3JOkF0XG5Qx2TlKWIA"
}
</code></pre>

<p>The above response is in accordance with <a href="https://tools.ietf.org/html/rfc6749#section-1.5">RFC 6749, section 1.5</a>.</p>

<p>For more information and Atom usage example, please see documentation and the provided Example application.</p>
<h2 id='communication' class='heading'>Communication</h2>

<ul>
<li>If you found a bug, open an issue.</li>
<li>If you have a feature request, open an issue.</li>
<li>If you want to contribute, submit a pull request.</li>
</ul>
<h2 id='authors' class='heading'>Authors</h2>

<ul>
<li><a href="https://github.com/michaelbabiy">Michael Babiy</a></li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2020 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2020-01-24)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
