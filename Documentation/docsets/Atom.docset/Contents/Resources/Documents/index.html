<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Atom  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="Atom  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Atom Docs</a> (98% documented)</p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Atom Reference</a>
        <img id="carat" src="img/carat.png" />
        Atom  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Atom.html">Atom</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Service.html">Service</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ServiceConfiguration.html">ServiceConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ServiceConfiguration/Configuration.html">– Configuration</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AtomError.html">AtomError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/AuthenticationMethod.html">AuthenticationMethod</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HTTPMethod.html">HTTPMethod</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RequestableError.html">RequestableError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions.html#/s:10Foundation4DataV">Data</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLRequest.html">URLRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLResponse.html">URLResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLSessionTask.html">URLSessionTask</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLSessionTaskMetrics.html">URLSessionTaskMetrics</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/BasicCredentialConvertible.html">BasicCredentialConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ClientCredentialConvertible.html">ClientCredentialConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:4Atom5ModelP">Model</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Requestable.html">Requestable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RequestableItem.html">RequestableItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TokenCredentialWritable.html">TokenCredentialWritable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AtomResponse.html">AtomResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AuthorizationEndpoint.html">AuthorizationEndpoint</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/BaseURL.html">BaseURL</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/BaseURL/Scheme.html">– Scheme</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/BasicCredential.html">BasicCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ClientCredential.html">ClientCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ClientCredential/GrantType.html">– GrantType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HeaderItem.html">HeaderItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/QueryItem.html">QueryItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TokenCredential.html">TokenCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/URLPath.html">URLPath</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h2 id='overview' class='heading'>Overview</h2>

<p>The lightweight &amp; delightful networking library.</p>

<p>Atom is a wrapper library built around a subset of features offered by <code>URLSession</code> with added ability to decode data into models, handle access token refresh and authorization headers on behalf of the client, and more. It takes advantage of Swift features such as default implementation for protocols, generics and <code>Decodable</code> to make it extremely easy to integrate and use in an existing project. Atom offers support for any endpoint, a much stricter URL host and path validation, comprehensive <a href="https://htmlpreview.github.com/?https://github.com/AlaskaAirlines/atom/blob/master/Documentation/index.html">documentation</a> and an example application to eliminate any guesswork.</p>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>[x] Simple to setup, easy to use &amp; efficient</li>
<li>[x] Supports any endpoint</li>
<li>[x] Supports Combine publishers</li>
<li>[x] Supports Multipath TCP configuration</li>
<li>[x] Handles object decoding from data returned by the service</li>
<li>[x] Handles token refresh</li>
<li>[x] Handles and applies authorization headers on behalf of the client</li>
<li>[x] Handles URL host validation</li>
<li>[x] Handles URL path validation</li>
<li>[x] Complete <a href="https://htmlpreview.github.com/?https://github.com/AlaskaAirlines/atom/blob/master/Documentation/index.html">Documentation</a></li>
</ul>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 12.0+</li>
<li>Xcode 12.0+</li>
<li>Swift 5.0+</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='swift-package-manager' class='heading'>Swift Package Manager</h3>

<p>The <a href="https://swift.org/package-manager/">Swift Package Manager</a> is a tool for automating the distribution of Swift code and is integrated into the <code>swift</code> compiler.</p>

<p>Once you have your Swift package set up, adding Atom as a dependency is as easy as adding it to the <code>dependencies</code> value of your <code>Package.swift</code>.</p>

<p>If you are using Xcode, adding Atom as a dependency is even easier. First, select your application, then your application project. Once you see <strong>Swift Packages</strong> tab at the top of the Project Editor, click on it. Click <code>+</code> button and add the following URL:</p>

<p><code>https://github.com/alaskaairlines/atom/</code></p>

<p>At this point you can setup your project to either use a branch or tagged version of the package.</p>
<h2 id='usage' class='heading'>Usage</h2>

<p>Getting started is easy. First, create an instance of Atom.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">atom</span> <span class="o">=</span> <span class="kt">Atom</span><span class="p">()</span>
</code></pre>

<p>In the above example, default configuration will be used. Default configuration will setup <code>URLSession</code>to use ephemeral configuration as well as ensure that the data returned by the service is available on the main thread.</p>

<p>Any endpoint needs to conform and implement <code><a href="Protocols/Requestable.html">Requestable</a></code> protocol. The <code><a href="Protocols/Requestable.html">Requestable</a></code> protocol provides default implementation for all of its properties - except for the <code>func baseURL() throws -&gt; BaseURL</code>. See <a href="https://htmlpreview.github.com/?https://github.com/AlaskaAirlines/atom/blob/master/Documentation/index.html">documentation</a> for more information.</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Seatmap</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">Endpoint</span><span class="p">:</span> <span class="kt">Requestable</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">refresh</span>

        <span class="kd">func</span> <span class="nf">baseURL</span><span class="p">()</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">BaseURL</span> <span class="p">{</span>
            <span class="k">try</span> <span class="kt">BaseURL</span><span class="p">(</span><span class="nv">host</span><span class="p">:</span> <span class="s">"api.alaskaair.net"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Atom offers a handful of methods with support for fully decoded model objects, raw data,  or status indicating success / failure of a request.</p>
<pre class="highlight swift"><code><span class="c1">// Completion based.</span>

<span class="kd">typealias</span> <span class="kt">Endpoint</span> <span class="o">=</span> <span class="kt">Seatmap</span><span class="o">.</span><span class="kt">Endpoint</span>

<span class="n">atom</span><span class="o">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="kt">Endpoint</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span><span class="o">.</span><span class="nf">resume</span><span class="p">(</span><span class="nv">expecting</span><span class="p">:</span> <span class="kt">Seatmap</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="c1">// Handle error.</span>

        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">seatmap</span><span class="p">):</span>
        <span class="c1">// Handle seatmap model.</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Publisher based.</span>

<span class="n">atom</span>
    <span class="o">.</span><span class="nf">enqueue</span><span class="p">(</span><span class="kt">Endpoint</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">resume</span><span class="p">(</span><span class="nv">expecting</span><span class="p">:</span> <span class="kt">Seatmap</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
        <span class="c1">// Handle `AtomError`.</span>
    <span class="p">}</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">seatmap</span> <span class="k">in</span>
        <span class="c1">// Handle decoded `Seatmap` instance.</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancelables</span><span class="p">)</span>
</code></pre>

<p>The above example demonstrates how to use <code>resume(expecting:)</code> function to get a fully decoded <code>Seatmap</code> model object.</p>

<p>For more information, please see <a href="https://htmlpreview.github.com/?https://github.com/AlaskaAirlines/atom/blob/master/Documentation/index.html">documentation</a>.</p>
<h3 id='authentication' class='heading'>Authentication</h3>

<p>Atom can be configured to apply authorization headers on behalf of the client. </p>

<p>Atom supports <code>Basic</code> and <code>Bearer</code> authentication methods. When configured properly, Atom will perform automatic token refresh on behalf of the client if it determines that the access token being used has expired. Any in-flight calls will be enqueued and resumed once a new token is obtained. </p>

<p>If the token refresh call fails, all enqueued network calls will be executed at once with completions set to <code><a href="Enums/AtomError.html">AtomError</a></code> failure.</p>
<h3 id='basic' class='heading'>Basic</h3>

<p>You can configure Atom to apply <code>Basic</code> authorization header like this:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">atom</span><span class="p">:</span> <span class="kt">Atom</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">credential</span> <span class="o">=</span> <span class="kt">BasicCredential</span><span class="p">(</span><span class="nv">password</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="s">"username"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">basic</span> <span class="o">=</span> <span class="kt">AuthenticationMethod</span><span class="o">.</span><span class="nf">basic</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">ServiceConfiguration</span><span class="p">(</span><span class="nv">authenticationMethod</span><span class="p">:</span> <span class="n">basic</span><span class="p">)</span>

    <span class="k">return</span> <span class="kt">Atom</span><span class="p">(</span><span class="nv">serviceConfiguration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
<span class="p">}()</span>

</code></pre>

<p>An existing implementation can be extended by conforming and implementing <code><a href="Protocols/BasicCredentialConvertible.html">BasicCredentialConvertible</a></code> protocol. A hypothetical configuration can look something like this:</p>
<pre class="highlight swift"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">CredentialManager</span> <span class="p">{</span>
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">username</span> <span class="o">=</span> <span class="kt">String</span><span class="p">()</span>
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">password</span> <span class="o">=</span> <span class="kt">String</span><span class="p">()</span>

    <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">CredentialManager</span><span class="p">()</span>
    <span class="kd">private</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="n">username</span> <span class="nv">aUsername</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">aUsername</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">update</span><span class="p">(</span><span class="n">password</span> <span class="nv">aPassword</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">aPassword</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">CredentialManager</span><span class="p">:</span> <span class="kt">BasicCredentialConvertible</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">basicCredential</span><span class="p">:</span> <span class="kt">BasicCredential</span> <span class="p">{</span>
        <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">atom</span><span class="p">:</span> <span class="kt">Atom</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">basic</span> <span class="o">=</span> <span class="kt">AuthenticationMethod</span><span class="o">.</span><span class="nf">basic</span><span class="p">(</span><span class="kt">CredentialManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">basicCredential</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">ServiceConfiguration</span><span class="p">(</span><span class="nv">authenticationMethod</span><span class="p">:</span> <span class="n">basic</span><span class="p">)</span>

    <span class="k">return</span> <span class="kt">Atom</span><span class="p">(</span><span class="nv">serviceConfiguration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
<span class="p">}()</span>

</code></pre>

<p>Once configured, Atom will combine username and password into a single string <code>username:password</code>, encode the result using base 64 encoding algorithm and apply it to a request as a <code>Authorization: Basic TGlmZSBoYXMgYSBtZWFuaW5nLg==</code> header key-value.</p>
<h3 id='bearer' class='heading'>Bearer</h3>

<p>You can configure Atom to apply <code>Bearer</code> authorization header. Here is an example:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">TokenManager</span><span class="p">:</span> <span class="kt">TokenCredentialWritable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">tokenCredential</span><span class="p">:</span> <span class="kt">TokenCredential</span> <span class="p">{</span>
        <span class="c1">// Read values from the keychain.</span>
        <span class="k">get</span> <span class="p">{</span> <span class="n">keychain</span><span class="o">.</span><span class="nf">tokenCredential</span><span class="p">()</span> <span class="p">}</span>

        <span class="c1">// Save new value to the keychain.  </span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">keychain</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="nv">tokenCredential</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>  <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">atom</span><span class="p">:</span> <span class="kt">Atom</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">endpoint</span> <span class="o">=</span> <span class="kt">AuthorizationEndpoint</span><span class="p">(</span><span class="nv">host</span><span class="p">:</span> <span class="s">"api.alaskaair.net"</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="s">"/oauth2"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">clientCredential</span> <span class="o">=</span> <span class="kt">ClientCredential</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"client-id"</span><span class="p">,</span> <span class="nv">secret</span><span class="p">:</span> <span class="s">"client-secret"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">tokenManager</span> <span class="o">=</span> <span class="kt">TokenManager</span><span class="p">()</span>

    <span class="k">let</span> <span class="nv">bearer</span> <span class="o">=</span> <span class="kt">AuthenticationMethod</span><span class="o">.</span><span class="nf">bearer</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">clientCredential</span><span class="p">,</span> <span class="n">tokenManager</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">ServiceConfiguration</span><span class="p">(</span><span class="nv">authenticationMethod</span><span class="p">:</span> <span class="n">bearer</span><span class="p">)</span>

    <span class="k">return</span> <span class="kt">Atom</span><span class="p">(</span><span class="nv">serviceConfiguration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
<span class="p">}()</span>
</code></pre>

<p>The setup is hopefully easy to understand. Atom requires a few pieces of information from the client:</p>

<ol>
<li>Authorization endpoint - Atom needs to know where to call to get a new token.</li>
<li>Client credentials - Atom needs access to client id and client secret to get a new token.</li>
<li>Token credential writable - Atom will pass newly obtained credentials to a client for safe storage.</li>
</ol>

<p>Once configured, Atom will apply authorization header to a request as <code>Authorization: Bearer ...</code> header key-value.</p>

<p>Please note, Atom will only decode token credential from a JSON objecting returned in this form:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2YotnFZFEjr1zCsicMWpAA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
    </span><span class="nl">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tGzv3JOkF0XG5Qx2TlKWIA"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The above response is in accordance with <a href="https://tools.ietf.org/html/rfc6749#section-1.5">RFC 6749, section 1.5</a>.</p>

<p>For more information and Atom usage example, please see <a href="https://htmlpreview.github.com/?https://github.com/AlaskaAirlines/atom/blob/master/Documentation/index.html">documentation</a> and the provided Example application.</p>
<h2 id='communication' class='heading'>Communication</h2>

<ul>
<li>If you found a bug, open an issue.</li>
<li>If you have a feature request, open an issue.</li>
<li>If you want to contribute, submit a pull request.</li>
</ul>
<h2 id='authors' class='heading'>Authors</h2>

<ul>
<li><a href="https://github.com/michaelbabiy">Michael Babiy</a></li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2020 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2020-12-21)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
